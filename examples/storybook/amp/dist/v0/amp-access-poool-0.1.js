(self.AMP=self.AMP||[]).push({n:"amp-access-poool",ev:"0.1",l:true,v:"2106040012000",m:0,f:function(AMP,_){"use strict";var p;function q(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var r=Array.isArray;function t(a){return a||{}}var u=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function v(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function w(a){var b=Object.create(null);if(!a)return b;for(var c;c=u.exec(a);){var d=v(c[1],c[1]);c=c[2]?v(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}var x="";function y(){var a=self;if(a.__AMP_MODE)var b=a.__AMP_MODE;else{b=w(a.location.originalHash||a.location.hash);x||(x=a.AMP_CONFIG&&a.AMP_CONFIG.v?a.AMP_CONFIG.v:"012106040012000");var c=w(a.location.originalHash||a.location.hash);c=!(!["1","actions","amp","amp4ads","amp4email"].includes(c.development)&&!a.AMP_DEV_MODE);b=a.__AMP_MODE={localDev:!1,development:c,examiner:"2"==b.development,esm:!1,geoOverride:b["amp-geo"],minified:!0,test:!1,log:b.log,version:"2106040012000",rtvVersion:x}}return b}var z=self.AMP_CONFIG||{},A=("string"==typeof z.cdnProxyRegex?new RegExp(z.cdnProxyRegex):z.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function B(a){if(self.document&&self.document.head&&(!self.location||!A.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}z.cdnUrl||B("runtime-host");z.geoApiUrl||B("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var C=self.__AMP_LOG;function D(){if(!C.user)throw Error("failed to call initLogConstructor");return C.user}function E(){if(C.dev)return C.dev;throw Error("failed to call initLogConstructor")}function F(a,b,c,d,e,f){return D().assert(a,b,c,d,e,f,void 0,void 0,void 0,void 0,void 0)}function G(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return H(a,b)}function I(a,b){var c=J(a);c=K(c);return H(c,b)}function J(a){return a.nodeType?G((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function K(a){a=J(a);return a.isSingleDoc()?a.win:a}function H(a,b){a=L(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function M(a){var b=L(a).access;if(b){if(b.promise)return b.promise;H(a,"access");return b.promise=Promise.resolve(b.obj)}return null}function L(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function aa(){var a=new q,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function ba(a){return ca(a).then((function(b){return F(b,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access","amp-access","amp-access","amp-access")}))}function ca(a){var b=M(K(a));if(b)return b;var c=J(a);return c.whenExtensionsKnown().then((function(){var d=c.getExtensionVersion("amp-access");return d?G(c.win,"extensions").waitForExtension("amp-access",d):null})).then((function(d){if(d){var e=K(a);var f=M(e);f?e=f:(e=L(e),e.access=aa(),e=e.access.promise)}else e=null;return e}))}function N(){this.I=100;this.B=this.C=0;this.A=Object.create(null)}N.prototype.has=function(a){return!!this.A[a]};N.prototype.get=function(a){var b=this.A[a];if(b)return b.access=++this.B,b.payload};N.prototype.put=function(a,b){this.has(a)||this.C++;this.A[a]={payload:b,access:this.B};if(!(this.C<=this.I)){a=this.A;var d,c=this.B+1;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.C--)}};t({c:!0,v:!0,a:!0,ad:!0});var O,P;function da(a){O||(O=self.document.createElement("a"),P=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new N));var b=P,c=O;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}function Q(a,b,c){if(!b)return a;var d=a.split("#",2),e=d[0].split("?",2),f=e[0]+(e[1]?c?"?"+b+"&"+e[1]:"?"+e[1]+"&"+b:"?"+b);return f+=d[1]?"#"+d[1]:""}function ea(a,b){b=encodeURIComponent("iid")+"="+encodeURIComponent(b);return Q(a,b,void 0)}function fa(a,b){var d,c=[];for(d in b){var e=b[d];if(null!=e)if(r(e))for(var f=0;f<e.length;f++){var g=e[f];c.push(encodeURIComponent(d)+"="+encodeURIComponent(g))}else c.push(encodeURIComponent(d)+"="+encodeURIComponent(e))}b=c.join("&");return Q(a,b)}function R(a,b){try{return JSON.parse(a)}catch(c){return null==b||b(c),null}}function ha(a){if(!S(a))return null;var b=a.indexOf("{");return R(a.substr(b),(function(c){return E().error("MESSAGING","Failed to parse message: "+a,c)}))}function S(a){return"string"==typeof a&&0==a.indexOf("amp-")&&-1!=a.indexOf("{")}var T,U="Webkit webkit Moz moz ms O o".split(" ");function V(a,b,c){var d=a.style;if(!b.startsWith("--")){T||(T=Object.create(null));var e=T[b];if(!e){e=b;if(void 0===d[b]){var f=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var g=0;g<U.length;g++){var l=U[g]+f;if(void 0!==d[l]){f=l;break b}}f=""}void 0!==d[f]&&(e=f)}T[b]=e}b=e}b&&(b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c)}function ia(a){for(var b=["transform"],c=0;c<b.length;c++)V(a,b[c],null)}function W(a,b,c){var d=a.listeningFors;!d&&c&&(d=a.listeningFors=Object.create(null));a=d||null;if(!a)return a;var e=a[b];!e&&c&&(e=a[b]=[]);return e||null}function ja(a,b){a=W(a,"amp",!0);for(var c,d=0;d<a.length;d++){var e=a[d];if(e.frame===b){c=e;break}}c||(c={frame:b,events:Object.create(null)},a.push(c));return c.events}function ka(a){for(var b=t({sentinel:"unlisten"}),c=a.length-1;0<=c;c--){var d=a[c];if(!d.frame.contentWindow){a.splice(c,1);var f,e=d.events;for(f in e)e[f].splice(0,1/0).forEach((function(g){g(b)}))}}}function la(a){a.listeningFors||a.addEventListener("message",(function(b){if(b.data){var c=ma(b.data);if(c&&c.sentinel){var d=b.source;var e=W(a,c.sentinel);if(e){for(var f,g=0;g<e.length;g++){var l=e[g],k=l.frame.contentWindow;if(k){var h;if(!(h=d==k))b:{for(h=d;h&&h!=h.parent;h=h.parent)if(h==k){h=!0;break b}h=!1}if(h){f=l;break}}else setTimeout(ka,0,e)}d=f?f.events:null}else d=e;var n=d;if(n){var m=n[c.type];if(m)for(m=m.slice(),d=0;d<m.length;d++)(0,m[d])(c,b.source,b.origin,b)}}}}))}function X(a,b,c){function d(k,h,n,m){if("amp"==k.sentinel){if(h!=a.contentWindow)return;var na="null"==n&&void 0;if(f!=n&&!na)return}h==a.contentWindow&&("unlisten"==k.sentinel?l():c(k,h,n,m))}var e=a.ownerDocument.defaultView;la(e);e=ja(e,a);var f=da(a.src).origin,g=e[b]||(e[b]=[]);g.push(d);var l=function(){if(d){var k=g.indexOf(d);-1<k&&g.splice(k,1);c=g=d=null}}}function ma(a){"string"==typeof a&&(a="{"==a.charAt(0)?R(a,(function(b){E().warn("IFRAME-HELPER","Postmessage could not be parsed. Is it in a valid JSON format?",b)}))||null:S(a)?ha(a):null);return a}var Y={authorization:"https://api.poool.fr/api/v3/amp/access?rid=READER_ID",iframe:"https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER"};function Z(a,b){this.ampdoc=a.ampdoc;this.o=b;this.F=I(this.ampdoc,"mutator");this.G=Y.authorization;this.J=Y.iframe;this.O=H(this.ampdoc.win,"timer");this.P=G(this.ampdoc.win,"xhr");this.K=I(this.ampdoc,"navigation");this.j=this.o.getAdapterConfig();this.H=this.j.bundleID||"";this.R="";this.D=this.j.itemID||"";this.h=this.ampdoc.win.document.createElement("iframe");this.h.setAttribute("id","poool-iframe");this.h.setAttribute("scrolling","no");this.h.setAttribute("frameborder","0");V(this.h,"width","100%");if("unlock"==this.j.forceWidget){var c=this.h,d={height:"250px",position:"fixed",bottom:"0"};for(e in d)V(c,e,d[e])}else{var e=this.h;d={height:"500px",transform:"translateY(-70px)"};for(c in d)V(e,c,d[c])}F(this.H,"BundleID is incorrect or not provided.");F(this.D,"ItemID is not provided.")}Z.prototype.authorize=function(){var a=this;return oa(this).then((function(b){return{access:b.access}}),(function(b){if(!b||!b.response)throw b;if(402!==b.response.status)throw b;pa(a);return{access:!1}}))};function oa(a){var b=ea(a.G,a.D);return a.o.buildUrl(b,!1).then((function(c){return a.o.getLoginUrl(c)})).then((function(c){E().info("amp-access-poool","Authorization URL: ",c);return a.O.timeoutPromise(3e3,a.P.fetchJson(c)).then((function(d){return d.json()}))}))}function qa(a){var b=a.ampdoc.getElementById("poool");return D().assertElement(b,"No element with id #poool found to render paywall into, got")}function pa(a){var b=qa(a);a.o.buildUrl(fa(a.J,t({bi:a.j.bundleID,iid:a.j.itemID,ce:a.j.cookiesEnabled,d:"undefined"!==typeof a.j.debug&&null!==a.j.debug?a.j.debug:y().development||!1,fw:a.j.forceWidget,cs:a.j.customSegment,lo:a.j.locale,co:a.j.context})),!1).then((function(c){a.h.src=c;X(a.h,"release",a.M.bind(a));X(a.h,"resize",a.N.bind(a));X(a.h,"click",a.L.bind(a));b.appendChild(a.h)}))}Z.prototype.M=function(){var a=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");a&&this.F.mutateElement(a,(function(){a.setAttribute("amp-access-hide","")}));var b=this.ampdoc.getRootNode().querySelector("[poool-access-content]");b&&this.F.mutateElement(b,(function(){b.removeAttribute("amp-access-hide")}));ia(this.h)};Z.prototype.N=function(a){V(this.h,"height",a.height)};Z.prototype.L=function(a){a.url&&this.K.navigateTo(this.ampdoc.win,a.url)};Z.prototype.pingback=function(){p||(p=Promise.resolve(void 0));var a=p;return a};(function(a){a.registerServiceForDoc("poool",(function(b){b=b.getHeadNode();return ba(b).then((function(c){var d=c.getVendorSource("poool"),e=new Z(c,d);d.getAdapter().registerVendor(e);return e}))}))})(self.AMP)}});//# sourceMappingURL=amp-access-poool-0.1.js.map