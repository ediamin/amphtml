(self.AMP=self.AMP||[]).push({n:"amp-geo",ev:"0.1",l:true,v:"2106040012000",m:0,f:function(AMP,_){"use strict";var f="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function g(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}g(this);"function"===typeof Symbol&&Symbol("x");var h;if("function"==typeof Object.setPrototypeOf)h=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}h=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var t,r=h;function u(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var v=Array.isArray;var w=Object.prototype.toString;var x=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function y(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function D(a){var b=Object.create(null);if(!a)return b;for(var c;c=x.exec(a);){var d=y(c[1],c[1]);c=c[2]?y(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}var E="";function F(a){var b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{c=D(b.location.originalHash||b.location.hash);E||(E=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"012106040012000");var d=D(b.location.originalHash||b.location.hash);d=!(!["1","actions","amp","amp4ads","amp4email"].includes(d.development)&&!b.AMP_DEV_MODE);c=b.__AMP_MODE={localDev:!1,development:d,examiner:"2"==c.development,esm:!1,geoOverride:c["amp-geo"],minified:!0,test:!1,log:c.log,version:"2106040012000",rtvVersion:E}}return c}var G=self.AMP_CONFIG||{},H=("string"==typeof G.cdnProxyRegex?new RegExp(G.cdnProxyRegex):G.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function I(a){if(!self.document||!self.document.head||self.location&&H.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}var J={thirdParty:G.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:G.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof G.thirdPartyFrameRegex?new RegExp(G.thirdPartyFrameRegex):G.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:G.cdnUrl||I("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:H,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:G.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:G.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:G.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:G.geoApiUrl||I("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var K=self.__AMP_LOG;function L(){if(!K.user)throw Error("failed to call initLogConstructor");return K.user}function M(){if(K.dev)return K.dev;throw Error("failed to call initLogConstructor")}function N(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return O(a,b)}function P(a){a=Q(a);a=Q(a);a=a.isSingleDoc()?a.win:a;return R(a,"url")?O(a,"url"):null}function Q(a){return a.nodeType?N((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function O(a,b){R(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function R(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function aa(a){return"SCRIPT"==a.tagName&&a.hasAttribute("type")&&"APPLICATION/JSON"==a.getAttribute("type").toUpperCase()}var S={"preset-eea":"AT BE BG HR CY CZ DK EE FI FR DE GR HU IS IE IT LV LI LT LU MT NL NO PL PT RO SK SI ES SE GB AX IC EA GF PF TF GI GP GG JE MQ YT NC RE BL MF PM SJ VA WF EZ CH".split(" "),"preset-us-ca":["us-ca"]};function ba(a){var b;return!(null==(b=a.AMP_CONFIG)||!b.canary)}function ca(a,b){try{return JSON.parse(a)}catch(c){return null==b||b(c),null}}var da=/amp-iso-country-(\w+)/,T=/^(?:(\w{2})(?:\s(\w{2}-\w{2}))?)?\s*/;function U(a){a=AMP.BaseElement.call(this,a)||this;a.o=0;a.C=!1;a.h="unknown";a.B="unknown";a.j=[];a.A=[];return a}var V=AMP.BaseElement;U.prototype=f(V.prototype);U.prototype.constructor=U;if(r)r(U,V);else for(var W in V)if("prototype"!=W)if(Object.defineProperties){var X=Object.getOwnPropertyDescriptor(V,W);X&&Object.defineProperty(U,W,X)}else U[W]=V[W];U.D=V.prototype;U.prerenderAllowed=function(){return!0};U.prototype.buildCallback=function(){var a=this.element.children;a.length&&Y(1===a.length&&aa(a[0]),'amp-geo can only have one <script type="application/json"> child');a=a.length?ca(a[0].textContent,(function(){return Y(!1,"amp-geo Unable to parse JSON")})):{};var b=ea(this,a||{});Z.resolve(b)};function Y(a,b){return a?a:(Z.resolve(null),L().assert(a,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0))}function fa(a,b){var c=b.getBody().className.match(da),d=T.exec("{{AMP_ISO_COUNTRY_HOTPATCH}}");if(F(a.win).geoOverride&&ba(a.win)){var e=T.exec(F(a.win).geoOverride.toLowerCase());e[1]&&(a.h=e[1].toLowerCase(),e[2]&&(a.B=e[2].toLowerCase()),a.o=2)}else c&&!P(a.element).isProxyOrigin(a.win.location)?(a.o=1,a.h=c[1]):d[1]?(a.o=0,a.h=d[1].toLowerCase(),d[2]&&"us-ca"===d[2].toLowerCase()&&(a.B="us-ca")):""===d[0]&&J.geoApi?a.o=3:""===d[0]&&(a.C=!0,M().error("amp-geo","GEONOTPATCHED: amp-geo served unpatched, ISO country not set"));3!==a.o?(t||(t=Promise.resolve(void 0)),b=t):b=ha(a).then((function(l){if(l){var m=l.country,k=l.subdivision;a.h=m;k&&"us-ca"===m+"-"+k&&(a.B="us-ca")}else a.C=!0,M().error("amp-geo","GEONOTPATCHED: amp-geo served unpatched and API response not valid, ISO country not set")}));return b}function ia(a){var b=J.geoApi;return"string"!==typeof b?(L().error("amp-geo","geoApiUrl must be a string URL"),null):P(a.element).isSecure(b)?b:(L().error("amp-geo","geoApiUrl must be secure (https)"),null)}function ha(a){var b=ia(a);if(!b)return Promise.resolve(null);L().info("amp-geo","API request is being used for country, this may result in FOUC");return O(a.win,"timer").timeoutPromise(6e4,N(a.win,"xhr").fetchJson(b,{mode:"cors",method:"GET",credentials:"omit"}).then((function(c){return c.json()})).then((function(c){return/^[a-z]{2}$/i.test(c.country)?{country:c.country.toLowerCase(),subdivision:/^[a-z0-9]{1,3}$/i.test(c.subdivision)?c.subdivision.toLowerCase():null}:(L().error("amp-geo",'Invalid API response, expected schema not matched for property "country"'),null)})).catch((function(c){L().error("amp-geo","XHR country request failed",c);return null})),"Timeout (60 sec) reached waiting for API response").catch((function(c){L().error("amp-geo",c);return null}))}function ja(a,b){var c=b.ISOCountryGroups;c&&(Y("[object Object]"===w.call(c),"<amp-geo> ISOCountryGroups must be an object"),a.A=Object.keys(c),a.A.forEach((function(d){Y(/^[a-z]+[a-z0-9]*$/i.test(d)&&!/^amp/.test(d),"<amp-geo> ISOCountryGroups["+d+"] name is invalid");Y(v(c[d]),"<amp-geo> ISOCountryGroups["+d+"] must be an array");ka(a,c[d])&&a.j.push(d)})))}function ka(a,b){var c=b.reduce((function(d,e){if(/^preset-/.test(e))return Y(v(S[e]),"<amp-geo> preset "+e+" not found"),d.concat(S[e]);"unknown"==e||/^[a-zA-Z]{2}$/.test(e)?d.push(e):L().error("amp-geo"," country %s not valid, will be ignored",e);return d}),[]).map((function(d){return d.toLowerCase()}));return c.includes(a.h)||c.includes("us-ca")&&"us-ca"==a.B}function la(a){var b=a.classList,c=[],d=/^amp-iso-country-|^amp-geo-group-/i;for(a=b.length-1;0<a;a--)d.test(b[a])&&c.push(b[a]);return c}function ea(a,b){var c=a.getAmpDoc(),d={};return c.whenReady().then((function(){return c.waitForBodyOpen()})).then((function(e){return fa(a,c).then((function(){return e}))})).then((function(e){ja(a,b);var l=[];switch(a.o){case 2:l=la(e);case 0:case 3:d.ISOCountry=a.h;var m=a.j.map((function(k){d[k]=!0;return"amp-geo-group-"+k}));a.j.length||m.push("amp-geo-no-group");a.C&&m.push("amp-geo-error");d.ISOCountryGroups=a.j;m.push("amp-iso-country-"+a.h);a.mutateElement((function(){var k=e.classList;l.push("amp-geo-pending");l.forEach((function(z){k.remove(z)}));m.forEach((function(z){return k.add(z)}));if(b.AmpBind){var A=c.getElementById("ampGeo");A&&A.parentNode.removeChild(A);var B=c.win.document.createElement("amp-state"),C=c.win.document.createElement("script");C.setAttribute("type","application/json");C.textContent=JSON.stringify(d);B.appendChild(C);B.id="ampGeo";e.appendChild(B)}}),e)}return{ISOCountry:a.h,matchedISOCountryGroups:a.j,allISOCountryGroups:a.A,isInCountryGroup:a.isInCountryGroup.bind(a)}}))}U.prototype.isInCountryGroup=function(a){var b=this,c=a.trim().split(/,\s*/);return c.filter((function(d){return 0<=b.A.indexOf(d)})).length!==c.length?1:0<c.filter((function(d){return 0<=b.j.indexOf(d)})).length?2:3};var Z=null;(function(a){Z=new u;a.registerElement("amp-geo",U);a.registerServiceForDoc("geo",(function(){return Z.promise}))})(self.AMP)}});//# sourceMappingURL=amp-geo-0.1.js.map