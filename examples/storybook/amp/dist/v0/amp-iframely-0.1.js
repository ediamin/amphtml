(self.AMP=self.AMP||[]).push({n:"amp-iframely",ev:"0.1",l:true,v:"2106040012000",m:0,f:function(AMP,_){"use strict";var f="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function h(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}h(this);"function"===typeof Symbol&&Symbol("x");var k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var l;a:{var m={a:!0},n={};try{n.__proto__=m;l=n.a;break a}catch(a){}l=!1}k=l?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var p=k;function r(a){var b=["id","domain","key","url","img"];return Object.keys(a).reduce((function(c,d){b.includes(d)||(c[d]=a[d]);return c}),{})}var t=Array.isArray;var u=self.AMP_CONFIG||{},v=("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function w(a){if(self.document&&self.document.head&&(!self.location||!v.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}u.cdnUrl||w("runtime-host");u.geoApiUrl||w("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var x=self.__AMP_LOG;function y(a,b,c){if(!x.user)throw Error("failed to call initLogConstructor");x.user.assert(a,b,"amp-iframely",c,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0});function z(a,b){if(!b)return a;var c=a.split("#",2),d=c[0].split("?",2),e=d[0]+(d[1]?"?"+d[1]+"&"+b:"?"+b);return e+=c[1]?"#"+c[1]:""}function A(a){var c,b=[];for(c in a){var d=a[c];if(null!=d)if(t(d))for(var e=0;e<d.length;e++){var g=d[e];b.push(encodeURIComponent(c)+"="+encodeURIComponent(g))}else b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}function B(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var F;function G(a,b){function c(q){try{return e(q)}catch(C){var D,E;null==(E=(D=self).__AMP_REPORT_ERROR)||E.call(D,C);throw C}}var d=a,e=b,g=H();d.addEventListener("message",c,g?void 0:!1);return function(){var q;null==(q=d)||q.removeEventListener("message",c,g?void 0:!1);c=d=e=null}}function H(){if(void 0!==F)return F;F=!1;try{var a={get capture(){F=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return F}function I(a,b){return G(a,b)}var J,K="Webkit webkit Moz moz ms O o".split(" ");function L(a){var b=a.style;if("border".startsWith("--"))b="border";else{J||(J=Object.create(null));var c=J.border;if(!c){c="border";if(void 0===b.border){var d;b:{for(d=0;d<K.length;d++){var e=K[d]+"Border";if(void 0!==b[e]){d=e;break b}}d=""}void 0!==b[d]&&(c=d)}J.border=c}b=c}b&&(b.startsWith("--")?a.style.setProperty(b,"0px"):a.style[b]="0px")}function M(a,b){var c={needsRootBounds:!0},d=c=void 0===c?{}:c,e=d.needsRootBounds;return new b.IntersectionObserver(a,{threshold:d.threshold,root:b.parent&&b.parent!=b&&e?b.document:void 0})}new WeakMap;new WeakMap;var N,O;function P(a){N||(N=new WeakMap,O=new WeakMap);var b=O.get(a);b||(b=M((function(c){for(var d=new Set,e=c.length-1;0<=e;e--){var g=c[e].target;d.has(g)||(d.add(g),b.unobserve(g),N.get(g).resolve(c[e]),N.delete(g))}}),a),O.set(a,b));return b}function Q(a){if(N&&N.has(a))return N.get(a).promise;P(a.ownerDocument.defaultView).observe(a);var b=new B;N.set(a,b);return b.promise}function R(a){a=AMP.BaseElement.call(this,a)||this;a.C=null;a.h=null;a.j=null;a.B=null;a.o=null;a.A=null;a.D=null;return a}var S=AMP.BaseElement;R.prototype=f(S.prototype);R.prototype.constructor=R;if(p)p(R,S);else for(var T in S)if("prototype"!=T)if(Object.defineProperties){var U=Object.getOwnPropertyDescriptor(S,T);U&&Object.defineProperty(R,T,U)}else R[T]=S[T];R.G=S.prototype;R.prototype.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a||"fluid"==a||"intrinsic"==a};R.prototype.buildCallback=function(){this.j=this.element.getAttribute("data-id");this.o=this.element.getAttribute("data-url");this.A=this.element.getAttribute("data-key");this.D=r(this.element.dataset);var a="cdn.iframe.ly",b=this.element.getAttribute("data-domain");b&&V(b)&&(a=b);this.B="https://"+a+"/";y(this.element.getAttribute("data-id")||this.element.getAttribute("data-url"),'<%s> requires either "data-id" or a pair of "data-url" and "data-key" attributes for %s',this.element);this.j||(this.o&&y(this.A,"Iframely data-key must also be set when you specify data-url parameter at <%s> %s",this.element),this.A&&y(this.o,"Iframely data-url must also be set when you specify data-key parameter at <%s> %s",this.element),(this.A||this.o)&&y(!this.j,"Iframely data-id should not be set when there is already a pair of data-url and data-key for <%s> %s",this.element));(this.j&&this.o||this.j&&this.A)&&y(!this.j,"Only one way of setting either data-id or data-url and data-key supported for <%s> %s",this.element);this.C=W(this,"/iframe")};R.prototype.preconnectCallback=function(a){this.preconnect&&this.preconnect.o&&this.preconnect.url(this.B,a)};R.prototype.createPlaceholderCallback=function(){var a=this.getLayout();if(this.element.hasAttribute("data-img")||"responsive"===a&&!this.element.hasAttribute("resizable")){a=W(this,"/thumbnail");a={src:z(a,A(this.D)),loading:"lazy",placeholder:""};var c,b=this.element.ownerDocument.createElement("img");for(c in a)b.setAttribute(c,a[c]);this.applyFillContent(b);return b}return null};R.prototype.layoutCallback=function(){var a=this;this.h=this.element.ownerDocument.createElement("iframe");L(this.h);this.h.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-presentation");this.C=z(this.C,A(this.D));this.h.src=this.C;this.applyFillContent(this.h);this.element.appendChild(this.h);this.H=I(this.win,(function(b){b.source===a.h.contentWindow&&X(a,b)}));return this.loadPromise(this.h)};function X(a,b){try{var c=JSON.parse(b.data)}catch(e){c=null}if(b=c){if("resize"===b.method&&50<b.height)a.attemptChangeHeight(b.height).catch((function(){}));else if("setIframelyEmbedData"===b.method){var d=b.data.media||null;d&&d["aspect-ratio"]&&Q(a.element).then((function(e){if(d["padding-bottom"])a.attemptChangeHeight(Math.round(e.boundingClientRect.width/d["aspect-ratio"]+d["padding-bottom"])).catch((function(){}));else{var g=e.boundingClientRect.width/d["aspect-ratio"];1<Math.abs(e.boundingClientRect.height-g)&&a.attemptChangeHeight(Math.round(g)).catch((function(){}))}}))}"cancelWidget"===b.method&&a.attemptCollapse().catch((function(){}))}}function W(a,b){return a.j?""+a.B+a.j+("/iframe"!==b?b:"")+"?amp=1":z(a.B+"api"+b,A({url:a.o,key:a.A,amp:"1"}))}R.prototype.unlayoutCallback=function(){if(this.h){var a=this.h;a.parentElement&&a.parentElement.removeChild(a);this.h=null}this.F&&(this.F(),this.F=null);return!0};function V(a){return[/^(?:[^\.\/]+\.)?iframe\.ly$/i,/^if\-cdn\.com$/i,/^iframely\.net$/i,/^oembed\.vice\.com$/i,/^iframe\.nbcnews\.com$/i].reduce((function(b,c){return b||c.test(a)}),!1)}(function(a){a.registerElement("amp-iframely",R)})(self.AMP)}});//# sourceMappingURL=amp-iframely-0.1.js.map