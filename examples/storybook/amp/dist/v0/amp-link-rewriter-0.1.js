(self.AMP=self.AMP||[]).push({n:"amp-link-rewriter",ev:"0.1",l:true,v:"2106040012000",m:0,f:function(AMP,_){"use strict";var g="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function k(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}k(this);"function"===typeof Symbol&&Symbol("x");var m;if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var r=m;var v=Object.prototype.hasOwnProperty;var w=self.AMP_CONFIG||{},x=("string"==typeof w.cdnProxyRegex?new RegExp(w.cdnProxyRegex):w.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function y(a){if(self.document&&self.document.head&&(!self.location||!x.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}w.cdnUrl||y("runtime-host");w.geoApiUrl||y("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var z=self.__AMP_LOG;function A(a){z.user||(z.user=E());var b=z.user.win;return a&&a.ownerDocument.defaultView!=b?z.userForEmbed?z.userForEmbed:z.userForEmbed=E():z.user}function E(){throw Error("failed to call initLogConstructor")}function F(a,b){var c=G(a);c=H(c);return I(c,b)}function G(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=I(b,"ampdoc").getAmpDoc(a)}return a}function H(a){a=G(a);return a.isSingleDoc()?a.win:a}function I(a,b){J(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function J(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var K;function L(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function M(a,b){return a.closest?a.closest(b):L(a,(function(c){var d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector;return d?d.call(c,b):!1}))}function O(a){function b(t){return t}var c=P,d=a.dataset;a={};var h,e=c?c:/^param(.+)/;for(h in d){var f=h.match(e);f&&(f=f[1][0].toLowerCase()+f[1].substr(1),a[b(f)]=d[h])}return a}function Q(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)}function R(a){var b={};Object.keys(a).forEach((function(c){b[c]="^"+a[c]+"$"}));return b}function S(a,b){var c=a.getRootNode(),d=b.section.join(" a, "),e=c.querySelectorAll("a"),h=[];0!==b.section.length&&(d+=" a",e=c.querySelectorAll(d));Q(e,(function(f){T(f,b)&&h.push(f)}));return h}function T(a,b){var c=b.attribute;return Object.keys(c).every((function(d){return new RegExp(c[d]).test(a.getAttribute(d))}))}var aa=["href","id","rel","rev"],P=/^vars(.+)/,U=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,ba={SOURCE_URL:!0,DOCUMENT_REFERRER:!0};function V(a,b,c){this.A=c;try{/^[\w-]+$/.test("script");if(void 0!==K)var d=K;else{try{var e=b.ownerDocument,h=e.createElement("div"),f=e.createElement("div");h.appendChild(f);var t=h.querySelector(":scope div")===f}catch(B){t=!1}d=K=t}if(d)var N=b.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{b.classList.add("i-amphtml-scoped");var ca="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),da=b.querySelectorAll(ca);b.classList.remove("i-amphtml-scoped");N=da}var C=N;if(1!==C.length)throw Error("Found "+C.length+" <script> children. Expected 1.");var u=C[0];if("SCRIPT"!=u.tagName||!u.hasAttribute("type")||"APPLICATION/JSON"!=u.getAttribute("type").toUpperCase())throw Error('<script> child must have type="application/json"');try{var ea=JSON.parse(u.textContent)}catch(B){throw Error("Failed to parse <script> contents. Is it valid JSON?")}var D=ea}catch(B){throw A(b).createError("%s: %s","amp-link-rewriter",B)}c=D;D=c.output;A().assert(D,"amp-link-rewriter: output config property is required",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0);var l;this.j={output:c.output.toString(),section:v.call(c,"section")?c.section:[],attribute:v.call(c,"attribute")?R(c.attribute):{},vars:v.call(c,"vars")?c.vars:{},scopeDocument:null!=(l=c.scopeDocument)?l:!0};this.B=S(this.A,this.j);this.o=a;this.h="";l=G(b);l=H(l);this.F=J(l,"url-replace")?I(l,"url-replace"):null}V.prototype.handleClick=function(a){if(a){this.h=this.j.output;var b;if(b=a.href.match(U)[1]!==this.h.match(U)[1])this.j.scopeDocument?b=fa(this,a):(b=this.j,b=!!T(a,b)&&(0===b.section.length?!0:!!M(a,b.section.join(","))));if(b){var c=F(this.A,"documentInfo").get().sourceUrl.match(U)[1],d=F(this.A,"documentInfo").get().canonicalUrl.match(U)[1];ha(a,[c,d])||(this.h=this.F.expandUrlSync(this.h,{DOCUMENT_REFERRER:this.o},ba),b=this.j.vars,b instanceof Object&&(a.href=ia(this,a,b)))}}};function fa(a,b){return null===a.B||0===a.B.length||0<a.B.filter((function(c){return c===b})).length?!0:!1}function ha(a,b){var c=a.href;return b.some((function(d){var e=c.match(U);return e?U.test(c)&&e[1]===d:!0}))}function ia(a,b,c){aa.forEach((function(e){b.getAttribute(e)&&(c[e]=b.getAttribute(e))}));var d=O(b);Object.assign(c,d);c.random=Math.random().toString(32).substr(2);Object.keys(c).forEach((function(e){c[e]&&(a.h=a.h.replace("${"+e+"}",encodeURIComponent(c[e])))}));a.h=a.h.replace(/\${[A-Za-z0-9]+}+/,(function(){return""}));return a.h}function W(a){a=AMP.BaseElement.call(this,a)||this;a.C=null;a.o="";return a}var X=AMP.BaseElement;W.prototype=g(X.prototype);W.prototype.constructor=W;if(r)r(W,X);else for(var Y in X)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(X,Y);Z&&Object.defineProperty(W,Y,Z)}else W[Y]=X[Y];W.G=X.prototype;W.prototype.buildCallback=function(){var a=this,b=F(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then((function(){return b.getReferrerUrl()})).then((function(c){return a.o=c})).then(this.D.bind(this))};W.prototype.D=function(){this.C=new V(this.o,this.element,this.getAmpDoc());ja(this)};function ja(a){F(a.getAmpDoc(),"navigation").registerAnchorMutator((function(b){a.C.handleClick(b)}),0)}W.prototype.isLayoutSupported=function(a){return"nodisplay"===a};(function(a){a.registerElement("amp-link-rewriter",W)})(self.AMP)}});//# sourceMappingURL=amp-link-rewriter-0.1.js.map