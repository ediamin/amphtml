(self.AMP=self.AMP||[]).push({n:"amp-viewer-integration",ev:"0.1",l:true,p:"high",v:"2106040012000",m:0,f:function(AMP,_){"use strict";var n;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function p(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}var q;function r(){return q?q:q=Promise.resolve(void 0)}function ba(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var ca=Array.isArray;function da(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e];b(f,e,a)?c.push(f):(d<e&&(a[d]=f),d++)}d<a.length&&(a.length=d);return c}function fa(a){var b=a.length-6;return 0<=b&&a.indexOf("sticky",b)==b}function t(a){return a||{}}function ha(a,b,c,d){return function(e){return w(e,a,b,c,d)}}function w(a,b,c,d,e){a:{var f=a-0;if(0>=f)a=0;else if(1<=f)a=1;else{for(var g=0,k=1,h=0,l=0;8>l;l++){h=x(f,b,d);var m=(x(f+1e-6,b,d)-h)/1e-6;if(1e-6>Math.abs(h-a)){a=f;break a}if(1e-6>Math.abs(m))break;else h<a?g=f:k=f,f-=(h-a)/m}for(l=0;1e-6<Math.abs(h-a)&&8>l;l++)h<a?(g=f,f=(f+k)/2):(k=f,f=(f+g)/2),h=x(f,b,d);a=f}}0==a?e=0:1==a?e=1:(b=y(0,c,a),c=y(c,e,a),e=y(e,1,a),b=y(b,c,a),c=y(c,e,a),e=y(b,c,a));return e}function x(a,b,c){if(0==a)return 0;if(1==a)return 1;var d=y(0,b,a),e=y(b,c,a),f=y(c,1,a);d=y(d,e,a);e=y(e,f,a);return y(d,e,a)}function y(a,b,c){return a+c*(b-a)}var ia={linear:function(a){return a},ease:function(a){return w(a,.25,.1,.25,1)},"ease-in":function(a){return w(a,.42,0,1,1)},"ease-out":function(a){return w(a,0,0,.58,1)},"ease-in-out":function(a){return w(a,.42,0,.58,1)}};function ja(a){if(!a)return null;if("string"==typeof a){if(-1!=a.indexOf("cubic-bezier")){var b=a.match(/cubic-bezier\((.+)\)/);if(b&&(b=b[1].split(",").map(parseFloat),4==b.length)){for(var c=0;4>c;c++)if(isNaN(b[c]))return null;return ha(b[0],b[1],b[2],b[3])}return null}return ia[a]}return a}var ka=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function la(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function ma(a){var b=Object.create(null);if(!a)return b;for(var c;c=ka.exec(a);){var d=la(c[1],c[1]);c=c[2]?la(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}function na(a){var b=!1,c=null,d=a;return function(e){for(var f=[],g=0;g<arguments.length;++g)f[g-0]=arguments[g];b||(c=d.apply(self,f),b=!0,d=null);return c}}var z=self.AMP_CONFIG||{},oa=("string"==typeof z.cdnProxyRegex?new RegExp(z.cdnProxyRegex):z.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function pa(a){if(!self.document||!self.document.head||self.location&&oa.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}var qa={thirdParty:z.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:z.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof z.thirdPartyFrameRegex?new RegExp(z.thirdPartyFrameRegex):z.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:z.cdnUrl||pa("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:oa,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:z.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:z.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:z.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:z.geoApiUrl||pa("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var A=self.__AMP_LOG;function B(){if(!A.user)throw Error("failed to call initLogConstructor");return A.user}function C(){if(A.dev)return A.dev;throw Error("failed to call initLogConstructor")}function ra(a,b,c){B().assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function sa(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return D(a,b)}function E(a,b){var c=F(a);c=ta(c);return D(c,b)}function ua(a){a=F(a);a=ta(a);return va(a,"hidden-observer")?D(a,"hidden-observer"):null}function F(a){return a.nodeType?sa((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function ta(a){a=F(a);return a.isSingleDoc()?a.win:a}function D(a,b){va(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function va(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function wa(a){return a.parent&&a.parent!=a}function xa(){}function G(a){this.K=a;this.A=sa(self,"vsync");this.qa=null;this.j=[]}function ya(a,b,c,d){return new G(a).setCurve(d).add(0,b,1).start(c)}G.prototype.setCurve=function(a){a&&(this.qa=ja(a));return this};G.prototype.add=function(a,b,c,d){this.j.push({delay:a,func:b,duration:c,curve:ja(d)});return this};G.prototype.start=function(a){return new H(this.A,this.K,this.j,this.qa,a)};function H(a,b,c,d,e){this.A=a;this.K=b;this.j=[];for(b=0;b<c.length;b++){var f=c[b];this.j.push({delay:f.delay,func:f.func,duration:f.duration,curve:f.curve||d,started:!1,completed:!1})}this.Ha=e;this.Ra=Date.now();this.G=!0;this.wa={};c=new ba;this.ua=c.promise;this.Oa=c.resolve;this.Ma=c.reject;this.ya=this.A.createAnimTask(this.K,{mutate:this.Sa.bind(this)});this.A.canAnimate(this.K)?this.ya(this.wa):(C().warn("Animation","cannot animate"),I(this,!1,0))}H.prototype.then=function(a,b){return a||b?this.ua.then(a,b):this.ua};H.prototype.thenAlways=function(a){a=a||xa;return this.then(a,a)};H.prototype.halt=function(a){I(this,!1,a||0)};function I(a,b,c){if(a.G){a.G=!1;if(0!=c){1<a.j.length&&a.j.sort((function(e,f){return e.delay+e.duration-(f.delay+f.duration)}));try{if(0<c)for(c=0;c<a.j.length;c++)a.j[c].func(1,!0);else for(var d=a.j.length-1;0<=d;d--)a.j[d].func(0,!1)}catch(e){C().error("Animation","completion failed: "+e,e),b=!1}}b?a.Oa():a.Ma()}}H.prototype.Sa=function(){if(this.G){for(var a=Date.now(),b=Math.min((a-this.Ra)/this.Ha,1),c=0;c<this.j.length;c++){var d=this.j[c];!d.started&&b>=d.delay&&(d.started=!0)}for(c=0;c<this.j.length;c++)if(d=this.j[c],d.started&&!d.completed)a:{var e;if(0<d.duration){var f=e=Math.min((b-d.delay)/d.duration,1);if(d.curve&&1!=f)try{f=d.curve(e)}catch(g){C().error("Animation","step curve failed: "+g,g);I(this,!1,0);break a}}else f=e=1;1==e&&(d.completed=!0);try{d.func(f,d.completed)}catch(g){C().error("Animation","step mutate failed: "+g,g),I(this,!1,0)}}1==b?I(this,!0,0):this.A.canAnimate(this.K)?this.ya(this.wa):(C().warn("Animation","cancel animation"),I(this,!1,0))}};function J(a,b){var c=this;this.za=D(a,"timer");this.Ka=b;this.Ga=0;this.M=-1;this.fa=0;this.G=!1;this.Ca=function(){c.M=-1;c.fa=0;c.G=!0;c.Ka();c.G=!1}}J.prototype.isPending=function(){return-1!=this.M};J.prototype.schedule=function(a){a=a||this.Ga;this.G&&10>a&&(a=10);var b=Date.now()+a;return!this.isPending()||-10>b-this.fa?(this.cancel(),this.fa=b,this.M=this.za.delay(this.Ca,a),!0):!1};J.prototype.cancel=function(){this.isPending()&&(this.za.cancel(this.M),this.M=-1)};var K,za="Webkit webkit Moz moz ms O o".split(" "),Aa={getPropertyPriority:function(){return""},getPropertyValue:function(){return""}};function L(a,b,c){if(b.startsWith("--"))return b;K||(K=Object.create(null));var d=K[b];if(!d||c){d=b;if(void 0===a[b]){var e=b.charAt(0).toUpperCase()+b.slice(1);a:{for(var f=0;f<za.length;f++){var g=za[f]+e;if(void 0!==a[g]){e=g;break a}}e=""}var k=e;void 0!==a[k]&&(d=k)}c||(K[b]=d)}return d}function M(a,b,c){(b=L(a.style,b,void 0))&&(b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c)}function Ba(a,b){if(b=L(a.style,b,void 0))return b.startsWith("--")?a.style.getPropertyValue(b):a.style[b]}function N(a,b){for(var c in b)M(a,c,b[c])}function Ca(a){var b=!1;void 0===b&&(b=a.hasAttribute("hidden"));b?a.removeAttribute("hidden"):a.setAttribute("hidden","")}function Da(a,b,c,d,e){var f=this;this.ampdoc=a;this.A=b;this.Ba=c;this.S=this.ia=d;this.O=e&&a.isSingleDoc();this.D=null;this.Fa=0;this.h=[];this.Z=new J(a.win,(function(){return f.update()}));this.V=null;this.U=[];this.X=[]}n=Da.prototype;n.enterLightbox=function(a,b){var c=this,d=O(this);d&&d.setLightboxMode(!0);a&&b&&b.then((function(){Ea(c,a,!0);Fa(c);c.update()}))};n.leaveLightbox=function(){var a=O(this);a&&a.setLightboxMode(!1);var b=da(this.h,(function(c){return!!c.lightboxed}));Ia(this,b);this.h.length||Ja(this)};n.setup=function(){if(!E(this.ampdoc,"viewer").isEmbedded())return!1;var a=this.ampdoc.getRootNode(),b=a.styleSheets;if(!b)return!0;this.U.length=0;for(var c=this.X.length=0;c<b.length;c++){var d=b[c];if(!d)return C().error("FixedLayer","Aborting setup due to null stylesheet."),!0;var e=d,f=e.ownerNode;e.disabled||!f||"STYLE"!=f.tagName||f.hasAttribute("amp-boilerplate")||f.hasAttribute("amp-runtime")||f.hasAttribute("amp-extension")||Ka(this,d.cssRules)}Ea(this,a,void 0);Fa(this);this.update();0<this.h.length&&this.observeHiddenMutations();var g=sa(this.ampdoc.win,"platform");0<this.h.length&&!this.O&&g.isIos()&&B().warn("FixedLayer","Please test this page inside of an AMP Viewer such as Google's because the fixed or sticky positioning might have slightly different layout.");return!0};n.observeHiddenMutations=function(){La(this)};function Ja(a){a.Z.cancel();var b=a.V;b&&(b(),a.V=null)}function La(a){if(!a.V){var b=a.ampdoc.getRootNode();a.V=ua(b.documentElement||b).add((function(){a.Z.isPending()||a.Z.schedule(16)}))}}n.updatePaddingTop=function(a,b){this.ia=a;b||(this.S=a);this.update()};n.transformMutate=function(a){a?this.h.forEach((function(b){b.fixedNow&&b.top&&(M(b.element,"transition","none"),b.transform&&"none"!=b.transform?M(b.element,"transform",b.transform+" "+a):M(b.element,"transform",a))})):this.h.forEach((function(b){b.fixedNow&&b.top&&N(b.element,{transform:"",transition:""})}))};n.addElement=function(a,b){if(!Ma(this,a,"*","fixed",b))return r();Fa(this);this.observeHiddenMutations();return this.update()};n.removeElement=function(a){a=Na(this,a);Ia(this,a)};function Ia(a,b){0<b.length&&a.D&&a.A.mutate((function(){for(var c=0;c<b.length;c++){var d=b[c];"fixed"==d.position&&a.D.returnFrom(d)}}))}n.isDeclaredFixed=function(a){return!!a.__AMP_DECLFIXED};n.isDeclaredSticky=function(a){return!!a.__AMP_DECLSTICKY};n.update=function(){var a=this;this.h.filter((function(c){return!a.ampdoc.contains(c.element)})).forEach((function(c){return Na(a,c.element)}));if(0==this.h.length)return r();this.Z.cancel();var b=!1;return this.A.runPromise({measure:function(c){for(var d=a.h,e=[],f=a.ampdoc.win,g=0;g<d.length;g++){var k=void 0,h={top:"",bottom:"-9999vh",transition:"none"},l=d[g].element.style;for(k in h)l.setProperty(L(l,k),String(h[k]),"important")}for(g=0;g<d.length;g++)e.push((f.getComputedStyle(d[g].element)||Aa).top);for(g=0;g<d.length;g++)M(d[g].element,"bottom","");for(g=0;g<d.length;g++){h=k=d[g];l=h.element;var m=h.forceTransfer;h=f.getComputedStyle(l)||Aa;var u=l.offsetHeight,Q=l.offsetTop,nb=l.offsetWidth,v=h;l=v.bottom;var ob=void 0===v.display?"":v.display,Ga=void 0===v.position?"":v.position,pb=v.zIndex,qb=parseFloat(h.opacity);v=h[L(h,"transform")];h=h.top;var R="fixed"===Ga&&(m||0<nb&&0<u),Ha=fa(Ga);if("none"===ob||!R&&!Ha)c[k.id]={fixed:!1,sticky:!1,transferrable:!1,top:"",zIndex:""};else{if("auto"===h||e[g]!==h)h=R&&Q===a.S+a.Ba?"0px":"";var ea=!1;R&&(ea=!0===m?!0:!1===m?!1:0<qb&&300>u&&!(!h&&!l));ea&&(b=!0);c[k.id]={fixed:R,sticky:Ha,transferrable:ea,top:h,zIndex:pb,transform:v}}}},mutate:function(c){b&&a.O&&O(a).update();for(var d=a.h,e=0;e<d.length;e++){var f=d[e],g=c[f.id];M(f.element,"transition","none");M(f.element,"transition","");if(g){var k=e,h=g,l=f.element,m=f.fixedNow;f.fixedNow=h.fixed;f.stickyNow=h.sticky;f.top=h.fixed||h.sticky?h.top:"";f.transform=h.transform;!m||h.fixed&&h.transferrable||!a.D||a.D.returnFrom(f);h.top&&(h.fixed||h.sticky)&&!f.lightboxed&&(h.fixed||!a.O?M(l,"top","calc("+h.top+" + "+a.ia+"px)"):a.S===a.ia?M(l,"top",h.top):M(l,"top","calc("+h.top+" - "+a.S+"px)"));a.O&&h.fixed&&h.transferrable&&O(a).transferTo(f,k,h)}}}},{}).catch((function(c){C().error("FixedLayer","Failed to mutate fixed elements:",c)}))};function Ea(a,b,c){try{for(var d=0;d<a.U.length;d++)for(var e=a.U[d],f=b.querySelectorAll(e),g=0;g<f.length&&!(10<a.h.length);g++)Ma(a,f[g],e,"fixed",void 0,c);for(d=0;d<a.X.length;d++){var k=a.X[d],h=b.querySelectorAll(k);for(e=0;e<h.length;e++)Ma(a,h[e],k,"sticky",void 0,c)}}catch(l){C().error("FixedLayer","Failed to setup fixed elements:",l)}}function Ma(a,b,c,d,e,f){e||b.hasAttribute("style")&&(Ba(b,"top")||Ba(b,"bottom"))&&B().error("FixedLayer","Inline styles with `top`, `bottom` and other CSS rules are not supported yet for fixed or sticky elements (#14186). Unexpected behavior may occur.",b);if(-1!==b.tagName.indexOf("LIGHTBOX"))return!1;var g;a:{for(g=b;g&&void 0!==g;g=g.parentElement)if(-1!==g.tagName.indexOf("LIGHTBOX"))break a;g=null}var k=g;if(!f&&k)return!1;f=a.h;var h=[];for(g=0;g<f.length;g++){var l=f[g].element;if(l===b)break;if(l.contains(b))return!1;b.contains(l)&&h.push(l)}for(g=0;g<h.length;g++)a.removeElement(h[g]);g=null;for(l=0;l<f.length;l++){var m=f[l];if(m.element==b&&m.position==d){g=m;break}}l="fixed"==d;g?g.selectors.includes(c)||g.selectors.push(c):(a="F"+a.Fa++,b.setAttribute("i-amphtml-fixedid",a),l?b.__AMP_DECLFIXED=!0:b.__AMP_DECLSTICKY=!0,g={id:a,element:b,position:d,selectors:[c],fixedNow:!1,stickyNow:!1,lightboxed:!!k},f.push(g));g.forceTransfer=l?e:!1;return!0}function Na(a,b){for(var c=[],d=0;d<a.h.length;d++){var e=a.h[d];e.element===b&&(e.lightboxed||a.A.mutate((function(){M(b,"top","")})),a.h.splice(d,1),c.push(e))}a.h.length||Ja(a);return c}function Fa(a){a.h.sort((function(b,c){var d=b.element,e=c.element;return d===e?0:d.compareDocumentPosition(e)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS)?1:-1}))}function O(a){if(!a.O||a.D)return a.D;a.D=new Oa(a.ampdoc.win.document,a.A);return a.D}function Ka(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(4==d.type||12==d.type)Ka(a,d.cssRules);else if(1==d.type){var e=d.selectorText;d=d.style.position;"*"!==e&&d&&("fixed"===d?a.U.push(e):fa(d)&&a.X.push(e))}}}n.animateFixedElements=function(a,b,c,d,e){function f(k){return b-a+(a-b)*k}var g=this;this.updatePaddingTop(a,e);return 0>=c?r():ya(this.ampdoc.getRootNode(),(function(k){var h=f(k);g.transformMutate("translateY("+h+"px)")}),c,d).thenAlways((function(){g.transformMutate(null)}))};function Oa(a,b){this.T=a;this.A=b;this.C=a.body.cloneNode(!1);this.C.removeAttribute("style");b=this.C;var c={position:"absolute",top:0,left:0,height:0,width:0,pointerEvents:"none",overflow:"hidden",animation:"none",background:"none",border:"none",borderImage:"none",boxSizing:"border-box",boxShadow:"none",float:"none",margin:0,opacity:1,outline:"none",padding:"none",transform:"none",transition:"none"};"display"in c&&C().error("STYLE","`display` style detected in styles. You must use toggle instead.");N(b,c);this.C.style.display="block";a.documentElement.appendChild(this.C)}n=Oa.prototype;n.getRoot=function(){return this.C};n.setLightboxMode=function(a){var b=this;this.A.mutate((function(){var c=b.getRoot();a?c.setAttribute("i-amphtml-lightbox",""):c.removeAttribute("i-amphtml-lightbox")}))};n.update=function(){for(var a=this.T.body,b=this.C,c=a.attributes,d=b.attributes,e=0;e<c.length;e++){var f=c[e];"style"!==f.name&&d.setNamedItem(f.cloneNode(!1))}for(e=0;e<d.length;e++)f=d[e].name,"style"===f||"i-amphtml-lightbox"===f||a.hasAttribute(f)||(b.removeAttribute(f),e--)};n.transferTo=function(a,b,c){var d=a.element;if(d.parentElement!=this.C){C().fine("FixedLayer","transfer to fixed:",a.id,a.element);B().warn("FixedLayer","In order to improve scrolling performance in Safari, we now move the element to a fixed positioning layer:",a.element);if(!a.placeholder){M(d,"pointer-events","initial");var e=a.placeholder=this.T.createElement("i-amphtml-fpa");Ca(e);e.setAttribute("i-amphtml-fixedid",a.id)}M(d,"zIndex","calc("+(1e4+b)+" + "+(c.zIndex||0)+")");a.lightboxed&&d.classList.add("i-amphtml-lightbox-element");d.parentElement.replaceChild(a.placeholder,d);this.C.appendChild(d);a.selectors.some((function(f){try{var g=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector;var k=g?g.call(d,f):!1}catch(h){C().error("FixedLayer","Failed to test query match:",h),k=!1}return k}))||(B().warn("FixedLayer","Failed to move the element to the fixed position layer. This is most likely due to the compound CSS selector:",a.element),this.returnFrom(a))}};n.returnFrom=function(a){if(a.placeholder&&this.T.contains(a.placeholder)){var b=a.element,c=a.placeholder;C().fine("FixedLayer","return from fixed:",a.id,b);a.lightboxed&&b.classList.remove("i-amphtml-lightbox-element");this.T.contains(b)?(M(a.element,"zIndex",""),c.parentElement.replaceChild(b,c)):c.parentElement.removeChild(c)}};var P;function S(a,b,c,d){function e(l){try{return g(l)}catch(Q){var m,u;null==(u=(m=self).__AMP_REPORT_ERROR)||u.call(m,Q);throw Q}}var f=a,g=c,k=Pa(),h=!(null==d||!d.capture);f.addEventListener(b,e,k?d:h);return function(){var l;null==(l=f)||l.removeEventListener(b,e,k?d:h);e=f=g=null}}function Pa(){if(void 0!==P)return P;P=!1;try{var a={get capture(){P=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return P}function Qa(a,b,c,d){return S(a,b,c,d)}function Ra(a,b,c){var d=c,e=S(a,b,(function(f){try{d(f)}finally{d=null,e()}}),void 0)}function Sa(a,b){this.win=a;this.L=b;Qa(this.win.document,"focusin",this.aa.bind(this),{capture:!1})}Sa.prototype.aa=function(a){a.defaultPrevented||this.L.sendRequest(a.type,t({focusTargetRect:a.target.getBoundingClientRect()}),!1)};function T(a){this.da=a;this.P=[];this.W=0}T.prototype.push=function(a){this.P[this.W]=a;this.W=(this.W+1)%this.da};T.prototype.get=function(a){this.P.length>=this.da&&(a=(this.W+a)%this.da);return this.P[a]};T.prototype.size=function(){return this.P.length};var Ta=/[,.\s\u2022()]/;function Ua(a){return"’"==a||"‘"==a?"'":"“"==a||"”"==a?'"':a.toLowerCase()}function Va(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=[],f=0;f<d.length;f++){var g=d[f];Ta.test(g)||e.push(Ua(g))}var k=e.join("");k&&b.push(k)}return b}function Wa(a,b){this.Qa=a;this.Da=b;this.matches=[];this.va={};this.ma=a.length-1;for(b=0;b<a.length;b++)this.va[a[b]]=a.length-1-b}Wa.prototype.update=function(){if(0<this.ma)this.ma--;else{for(var a=this.Da,b=this.Qa,c=a.size(),d=0;d<b.length;d++){var e=a.get(c-1-d).pos;e=Ua(e.node.wholeText[e.offset]);if(b[b.length-1-d]!=e){var f=this.va[e];null==f&&(f=b.length);f-=d;1>f&&(f=1);this.ma=f-1;return}}var g=a.get(c-1),k=g.pos;this.matches.push({start:a.get(c-b.length),end:{pos:{node:k.node,offset:k.offset+1},idx:g.idx+1}})}};function Xa(a,b,c){c=Va(c);if(0>=c.length)return null;var d=new U(a,b);a=new T(c.map((function(l){return l.length})).reduce((function(l,m){return Math.max(l,m)})));for(var e=[new Wa(c[0],a)],f=-1;;){f++;b=d.next();if(null==b)return null;if(!Ta.test(b.node.wholeText[b.offset])){a.push({pos:b,idx:f});for(b=0;b<e.length;b++)e[b].update();if(0!=e[e.length-1].matches.length){if(e.length==c.length)break;e.push(new Wa(c[e.length],a))}}}a=[];c=c.length-1;a:for(;0<=c;c--){var g=e[c].matches;if(0==a.length)a.push(g[g.length-1]);else{var k=a[a.length-1];for(b=g.length-1;0<=b;b--){var h=g[b];if(k.start.idx>=h.end.idx){a.push(h);continue a}}}}c=[];for(b=a.length-1;0<=b;b--)h=a[b],c.push({start:h.start.pos,end:h.end.pos});return c}function Ya(a,b,c,d,e){if(c>=d)return null;a=a.document;var f=b.parentNode,g=b.wholeText;0<c&&f.insertBefore(a.createTextNode(g.substring(0,c)),b);var k=a.createElement("span");k.appendChild(a.createTextNode(g.substring(c,d)));f.insertBefore(k,b);e.push(k);var h=null;d<g.length&&(h=a.createTextNode(g.substring(d)),f.insertBefore(h,b));f.removeChild(b);return h}function U(a,b){this.I=a;this.ga=b;this.N=-1;this.J=null;b instanceof a.Text?this.N=0:b instanceof a.Element&&"none"!=(a.getComputedStyle(b)||Aa).display&&(b=b.firstChild,null!=b&&(this.J=new U(a,b)))}U.prototype.next=function(){if(0<=this.N){if(this.N<this.ga.wholeText.length){var a=this.N;this.N++;a={node:this.ga,offset:a}}else a=null;return a}for(;null!=this.J;){a=this.J.next();if(null!=a)return a;var b=this.J.ga.nextSibling;this.J=null!=b?new U(this.I,b):null}return null};function Za(a){if(a.__AMP__EXPERIMENT_TOGGLES)var b=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);b=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var c in a.AMP_CONFIG){var d=a.AMP_CONFIG[c];"number"===typeof d&&0<=d&&1>=d&&(b[c]=Math.random()<d)}var e;c=null==(e=a.AMP_CONFIG)?void 0:e["allow-doc-opt-in"];if(ca(c)&&c.length&&(e=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]')))for(e=e.getAttribute("content").split(","),d=p(e),e=d.next();!e.done;e=d.next())e=e.value,c.includes(e)&&(b[e]=!0);c=Object;e=c.assign;d="";try{"localStorage"in a&&(d=a.localStorage.getItem("amp-experiment-toggles"))}catch(h){C().warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var f;d=(null==(f=d)?void 0:f.split(/\s*,\s*/g))||[];f=Object.create(null);d=p(d);for(var g=d.next();!g.done;g=d.next())(g=g.value)&&("-"==g[0]?f[g.substr(1)]=!1:f[g]=!0);e.call(c,b,f);var k;f=null==(k=a.AMP_CONFIG)?void 0:k["allow-url-opt-in"];if(ca(f)&&f.length)for(a=ma(a.location.originalHash||a.location.hash),k=p(f),e=k.next();!e.done;e=k.next())f=e.value,c=a["e-"+f],"1"==c&&(b[f]=!0),"0"==c&&(b[f]=!1)}return!!b["use-text-fragments-for-highlights"]}function $a(a){return"loading"!=a.readyState&&"uninitialized"!=a.readyState}function ab(a,b){var c=$a(a);if(c)b(a);else{var d=function(){$a(a)&&(c||(c=!0,b(a)),a.removeEventListener("readystatechange",d))};a.addEventListener("readystatechange",d)}}function bb(a){return new Promise((function(b){ab(a,b)}))}function cb(a){a=ma(a.win.location.hash).highlight;if(!a||102400<a.length)return null;var b=JSON.parse(a),c=b.s;if(!(c instanceof Array)||15<c.length)return null;var d=0;for(a=0;a<c.length;a++){var e=c[a];if("string"!=typeof e||!e)return null;d+=e.length;if(1500<d)return null}var f=!1;b.n&&(f=!0);var g=!1;b.na&&(g=!0);return{sentences:c,skipScrollAnimation:g,skipRendering:f}}function V(a,b){var c=this;this.o=a;this.Ta=E(a,"viewer");this.F=E(this.o,"viewport");this.B=null;"fragmentDirective"in document&&Za(a.win)?a.whenFirstVisible().then((function(){return db(c,b)})):bb(a.win.document).then((function(){eb(c,b)}))}function db(a,b){b=b.sentences;if(null!=b&&b.length){var c=b.map((function(d){return"text="+encodeURIComponent(d)})).join("&");fb(a,c)}}function fb(a,b){var c=a.o.win.location.hash;c?a.o.win.location.replace(c+":~:"+b):a.o.win.location.replace("#:~:"+b)}function W(a,b,c){b=t({state:b});for(var d in c)b[d]=c[d];a.Ta.sendMessage("highlightState",b)}function gb(a,b){var c=a.o.win;if(b=Xa(c,a.o.getBody(),b.sentences)){for(var d=[],e=null,f=0;f<b.length;f++){var g=b[f];e&&e.end.node==g.start.node&&e.end.offset==g.start.offset?e.end=g.end:(e=g,d.push(g))}b=d;d=[];for(e=0;e<b.length;e++){f=b[e];var k=f.start,h=f.end;g=b;for(f=e;;){if(k.node==h.node){if(k=Ya(c,k.node,k.offset,h.offset,d))for(f+=1;f<g.length;f++){var l=g[f];if(h.node!=l.start.node)break;l.start.node=k;l.start.offset-=h.offset;if(h.node!=l.end.node)break;l.end.node=k;l.end.offset-=h.offset}break}a:{l=!0;for(var m=k.node;;){if(null==m){l=null;break a}if(l){var u=m.nextSibling;u?(m=u,l=!1):m=m.parentNode}else{if(m instanceof c.Text){l=m;break a}m.firstChild?m=m.firstChild:l=!0}}}Ya(c,k.node,k.offset,k.node.wholeText.length,d);if(!l)break;k={node:l,offset:0}}}d&&0!=d.length&&(a.B=d)}}V.prototype.onVisibleOnce=function(a){var b=this;a=na(a);this.o.onVisibilityChanged((function(){"visible"==b.o.getVisibilityState()&&a()}))};function eb(a,b){if(a.o.win.document.querySelector('script[id="amp-access"]'))W(a,"has_amp_access");else if(gb(a,b),a.B){var c=X(a);W(a,"found",t({scroll:c}));if(!b.skipRendering){for(var d=0;d<a.B.length;d++)N(a.B[d],{backgroundColor:"#fcff00",color:"#000"});var e=a.o.getVisibilityState();b.skipScrollAnimation?"visible"==e?hb(a,c):(a.F.setScrollTop(c),a.onVisibleOnce((function(){hb(a,X(a))}))):"visible"==e?ib(a,c):(a.F.setScrollTop(Math.max(0,c-500)),a.onVisibleOnce((function(){ib(a,X(a))})));Ra(a.o.getBody(),"click",a.sa.bind(a))}}else W(a,"not_found")}function X(a){var b=a.B;if(!b)return 0;a=a.F;for(var c=Number.MAX_VALUE,d=0,e=a.getPaddingTop(),f=0;f<b.length;f++){var g=a.getLayoutRect(b[f]),k=-e;if(0==k||0==g.width&&0==g.height)var h=g;else{h=g.left+0;k=g.top+k;var l=g.width;g=g.height;h={left:h,top:k,width:l,height:g,bottom:k+g,right:h+l,x:h,y:k}}g=h.bottom;c=Math.min(c,h.top);d=Math.max(d,g)}if(c>=d)return 0;b=a.getHeight()-e;b=(d+c-b)/2;b>c-80&&(b=c-80);return 0<b?b:0}function hb(a,b){W(a,"auto_scroll");a.F.setScrollTop(b);W(a,"shown")}function ib(a,b){a.F.setScrollTop(Math.max(0,b-500));var c=a.o.win.document.createElement("div");c.style.display="block";N(c,{position:"absolute",top:Math.floor(b)+"px",height:"1px",left:"0",width:"1px","pointer-events":"none"});var d=a.o.getBody();d.appendChild(c);W(a,"auto_scroll");a.F.animateScrollIntoView(c).then((function(){d.removeChild(c);var e=X(a);var f=a.F.getScrollTop();if(f==e&&f==b)e=null;else{var g={};f!=e&&(a.F.setScrollTop(e),g.nd=f-e);f!=b&&(g.od=f-b);e=g}W(a,"shown",e)}))}V.prototype.setupMessaging=function(a){a.registerHandler("highlightDismiss",this.sa.bind(this))};V.prototype.sa=function(){if(this.B)for(var a=0;a<this.B.length;a++)for(var b=this.B[a],c=["backgroundColor","color"],d=0;d<c.length;d++)M(b,c[d],null)};var jb="key code location ctrlKey shiftKey altKey metaKey repeat isComposing charCode keyCode which".split(" ");function kb(a,b){this.win=a;this.L=b;a=this.ba.bind(this);S(this.win,"keydown",a,void 0);S(this.win,"keypress",a,void 0);S(this.win,"keyup",a,void 0)}kb.prototype.ba=function(a){lb(a)||this.aa(a)};kb.prototype.aa=function(a){this.L.sendRequest(a.type,mb(a),!1)};function lb(a){if(a.defaultPrevented)return!0;if("Escape"==a.key)return!1;switch(a.target.nodeName){case"INPUT":return"checkbox"!=a.target.type||" "==a.key;case"TEXTAREA":case"BUTTON":case"SELECT":case"OPTION":return!0}return a.target.hasAttribute&&a.target.hasAttribute("contenteditable")}function mb(a){var b={};jb.forEach((function(c){void 0!==a[c]&&(b[c]=a[c])}));return b}function rb(a){if("string"!=typeof a)return a;if("{"!=a.charAt(0))return null;try{return JSON.parse(a)}catch(b){return null}}function Y(a,b,c){this.I=a;this.ha=b;this.xa=c}Y.prototype.addEventListener=function(a,b){var c=this;this.I.addEventListener("message",(function(d){d.origin==c.ha&&d.source==c.xa&&b(d)}))};Y.prototype.postMessage=function(a){this.xa.postMessage(a,"null"===this.ha?"*":this.ha)};Y.prototype.start=function(){};function sb(a,b,c,d){this.I=a;this.ja=b;this.La=!!c;this.Y=d||null;this.Aa=!1;this.Na=0;this.pa={};this.ea={};this.ra=null;this.ja.addEventListener("message",this.Ia.bind(this));this.ja.start()}n=sb.prototype;n.registerHandler=function(a,b){this.ea[a]=b};n.unregisterHandler=function(a){delete this.ea[a]};n.setDefaultHandler=function(a){this.ra=a};n.Ia=function(a){if((a=rb(a.data))&&"__AMPHTML__"===a.app)if(this.Y&&this.Aa&&a.messagingToken!==this.Y)tb(this,"amp-viewer-messaging: handleMessage_ error: ","invalid token");else if("q"===a.type)ub(this,a);else if("s"===a.type){var b=a.requestid,c=this.pa[b];c&&(delete this.pa[b],a.error?(tb(this,"amp-viewer-messaging: handleResponse_ error: ",a.error),c.reject(Error("Request "+a.name+" failed: "+a.error))):c.resolve(a.data))}};n.sendRequest=function(a,b,c){var d=this,e=++this.Na,f=void 0;c&&(f=new Promise((function(g,k){d.pa[e]={resolve:g,reject:k}})));vb(this,{app:"__AMPHTML__",requestid:e,type:"q",name:a,data:b,rsvp:c});return f};function wb(a,b,c,d){var e=d?d.message?d.message:String(d):"unknown error";tb(a,"amp-viewer-messaging: sendResponseError_, message name: "+c,e);vb(a,{app:"__AMPHTML__",requestid:b,type:"s",name:c,data:null,error:e})}function vb(a,b){var c=Object.assign(b,{});a.Y&&!a.Aa&&(c.messagingToken=a.Y);a.ja.postMessage(a.La?JSON.stringify(c):c)}function ub(a,b){var c=a.ea[b.name];c||(c=a.ra);if(!c)throw c=Error("Cannot handle request because no default handler is set!"),c.args=b.name,c;c=c(b.name,b.data,!!b.rsvp);if(b.rsvp){var d=b.requestid;if(!c)throw wb(a,d,b.name,Error("no response")),Error("expected response but none given: "+b.name);c.then((function(e){vb(a,{app:"__AMPHTML__",requestid:d,type:"s",name:b.name,data:e})}),(function(e){wb(a,d,b.name,e)}))}}function tb(a,b,c){if(a.I){var d="amp-messaging-error-logger: "+b;d+=" data: "+(c?c.message?c.message:String(c):"unknown error");a.I.viewerState=d}}var xb="altKey charCode ctrlKey detail eventPhase key layerX layerY metaKey pageX pageY returnValue shiftKey timeStamp type which".split(" "),yb="clientX clientY force identifier pageX pageY radiusX radiusY screenX screenY".split(" ");function zb(a,b){this.win=a;this.L=b;this.ka=!1;this.oa=[];b.registerHandler("scrollLock",this.Pa.bind(this));Ab(this)}function Ab(a){var b=a.ba.bind(a),c=a.win.document,d={capture:!1,passive:!a.ka};a.oa.push(S(c,"touchstart",b,d),S(c,"touchend",b,d),S(c,"touchmove",b,d))}function Bb(a){a.oa.forEach((function(b){return b()}));a.oa.length=0}zb.prototype.ba=function(a){switch(a.type){case"touchstart":case"touchend":case"touchmove":if(null==a?0:a.shouldViewerCancelPropagation)a.stopImmediatePropagation();else{if(a&&a.type){var b=Cb(a,xb);a.touches&&(b.touches=Db(a.touches));a.changedTouches&&(b.changedTouches=Db(a.changedTouches));this.L.sendRequest(a.type,b,!1)}this.ka&&a.cancelable&&a.preventDefault()}}};function Db(a){for(var b=[],c=0;c<a.length;c++)b.push(Cb(a[c],yb));return b}function Cb(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];void 0!==a[e]&&(c[e]=a[e])}return c}zb.prototype.Pa=function(a,b,c){this.ka=!!b;Bb(this);Ab(this);return c?Promise.resolve({}):void 0};function Z(){this.Ea=100;this.$=this.la=0;this.R=Object.create(null)}Z.prototype.has=function(a){return!!this.R[a]};Z.prototype.get=function(a){var b=this.R[a];if(b)return b.access=++this.$,b.payload};Z.prototype.put=function(a,b){this.has(a)||this.la++;this.R[a]={payload:b,access:this.$};if(!(this.la<=this.Ea)){a=this.R;b=this.$+1;var c;for(c in a){var d=a[c].access;if(d<b){b=d;var e=c}}void 0!==e&&(delete a[e],this.la--)}};var Fb,Gb,Eb=t({c:!0,v:!0,a:!0,ad:!0}),Hb=/[?&]amp_js[^&]*/,Ib=/[?&]amp_gsa[^&]*/,Jb=/[?&]amp_r[^&]*/,Kb=/[?&]amp_kit[^&]*/,Lb=/[?&]usqp[^&]*/;function Mb(a){Fb||(Fb=self.document.createElement("a"),Gb=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new Z));var b=Gb,c=Fb;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}function Nb(a){"string"==typeof a&&(a=Mb(a));var b=a;"string"==typeof b&&(b=Mb(b));if(!qa.cdnProxyRegex.test(b.origin))return a.href;b=a.pathname.split("/");ra(Eb[b[1]],"Unknown path prefix in url %s",a.href);var c=b[2],d="s"==c?"https://"+decodeURIComponent(b[3]):"http://"+decodeURIComponent(c);ra(0<d.indexOf("."),"Expected a . in origin %s",d);b.splice(1,"s"==c?3:2);b=d+b.join("/");d=(d=a.search)&&"?"!=d?(d=d.replace(Hb,"").replace(Ib,"").replace(Jb,"").replace(Kb,"").replace(Lb,"").replace(/^[?&]/,""))?"?"+d:"":"";return b+d+(a.hash||"")}function Ob(a){this.win=a;this.ta=this.H=!1;this.ca=null}Ob.prototype.init=function(){var a=this;C().fine("amp-viewer-integration","handshake init()");var b=F(this.win.document),c=E(b,"viewer");this.H="1"==c.getParam("webview");this.ta=c.hasCapability("handshakepoll");var d=c.getParam("messagingToken"),e=c.getParam("origin")||"";if(!this.H&&!e)return r();E(b,"viewport").createFixedLayer(Da);if(this.H||this.ta){var f=wa(this.win)?this.win.parent:null;return Pb(this,f,e).then((function(g){return Qb(a,c,b,e,new sb(a.win,g,a.H,d))}))}if(f=cb(b))this.ca=new V(b,f);f=new Y(this.win,e,this.win.parent);return Qb(this,c,b,e,new sb(this.win,f,this.H,d))};function Pb(a,b,c){return new Promise((function(d){var e=Qa(a.win,"message",(function(f){C().fine("amp-viewer-integration","AMPDOC got a pre-handshake message:",f.type,f.data);var g=rb(f.data);if(g&&f.origin===c&&f.source===b&&"__AMPHTML__"==g.app&&"handshake-poll"==g.name){if(a.H&&(!f.ports||!f.ports.length))throw Error("Did not receive communication port from the Viewer!");f=f.ports&&0<f.ports.length?f.ports[0]:new Y(a.win,c,a.win.parent);d(f);e()}}))}))}function Qb(a,b,c,d,e){C().fine("amp-viewer-integration","Send a handshake request");var f=c.getUrl(),g=Nb(f);return e.sendRequest("channelOpen",t({url:f,sourceUrl:g}),!0).then((function(){C().fine("amp-viewer-integration","Channel has been opened!");Rb(a,e,b,d)}))}function Rb(a,b,c,d){b.setDefaultHandler((function(e,f,g){return c.receiveMessage(e,f,g)}));c.setMessageDeliverer(b.sendRequest.bind(b),d);Ra(a.win,"unload",a.Ja.bind(a,b));(c.hasCapability("swipe")||c.hasCapability("touch"))&&new zb(a.win,b);c.hasCapability("keyboard")&&new kb(a.win,b);c.hasCapability("focus-rect")&&new Sa(a.win,b);null!=a.ca&&a.ca.setupMessaging(b)}Ob.prototype.Ja=function(a){return a.sendRequest("unloaded",{},!0)};(function(a){new Ob(a.win).init()})(self.AMP)}});//# sourceMappingURL=amp-viewer-integration-0.1.js.map