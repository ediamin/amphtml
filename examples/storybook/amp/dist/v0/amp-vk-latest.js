(self.AMP=self.AMP||[]).push({n:"amp-vk",ev:"0.1",l:true,v:"2106040012000",m:0,f:function(AMP,_){"use strict";var f,g="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function h(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}h(this);"function"===typeof Symbol&&Symbol("x");var k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var l;a:{var m={a:!0},n={};try{n.__proto__=m;l=n.a;break a}catch(a){}l=!1}k=l?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var r=k,t=Array.isArray;function u(a){return a||{}}var v=self.AMP_CONFIG||{},w=("string"==typeof v.cdnProxyRegex?new RegExp(v.cdnProxyRegex):v.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function x(a){if(self.document&&self.document.head&&(!self.location||!w.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}v.cdnUrl||x("runtime-host");v.geoApiUrl||x("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var y=self.__AMP_LOG;function z(a,b,c){if(!y.user)throw Error("failed to call initLogConstructor");return y.user.assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function A(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return B(a,b)}function C(a){var b=D(a);b=D(b);b=b.isSingleDoc()?b.win:b;return B(b,"viewer")}function D(a){return a.nodeType?A((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function B(a,b){var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
u({c:!0,v:!0,a:!0,ad:!0});function E(a,b){if(!b)return a;var c=a.split("#",2),d=c[0].split("?",2),e=d[0]+(d[1]?"?"+d[1]+"&"+b:"?"+b);return e+=c[1]?"#"+c[1]:""}function I(a){var c,b=[];for(c in a){var d=a[c];if(null!=d)if(t(d))for(var e=0;e<d.length;e++){var p=d[e];b.push(encodeURIComponent(c)+"="+encodeURIComponent(p))}else b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}var J;function K(a,b){function c(q){try{return e(q)}catch(F){var G,H;null==(H=(G=self).__AMP_REPORT_ERROR)||H.call(G,F);throw F}}var d=a,e=b,p=L();d.addEventListener("message",c,p?void 0:!1);return function(){var q;null==(q=d)||q.removeEventListener("message",c,p?void 0:!1);c=d=e=null}}function L(){if(void 0!==J)return J;J=!1;try{var a={get capture(){J=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return J}function M(a,b){return K(a,b)}function N(a){a=AMP.BaseElement.call(this,a)||this;a.j=null;a.G=0;a.o=null;a.h=null;a.C=null;a.F=null;a.B=null;a.A=null;a.D=null;return a}var O=AMP.BaseElement;N.prototype=g(O.prototype);N.prototype.constructor=N;if(r)r(N,O);else for(var P in O)if("prototype"!=P)if(Object.defineProperties){var Q=Object.getOwnPropertyDescriptor(O,P);Q&&Object.defineProperty(N,P,Q)}else N[P]=O[P];N.I=O.prototype;f=N.prototype;f.preconnectCallback=function(a){A(this.win,"preconnect").url(this.getAmpDoc(),"https://vk.com",a)};function R(a){var c,b=Date.now().toString(16);"post"===a.h?c=S(a):"poll"===a.h&&(c=T(a));return c.then((function(d){return E(d,b)}))}function S(a){return C(a.element).getReferrerUrl().then((function(b){var c=a.element.offsetWidth,d=a.getAmpDoc().getUrl(),e=u({app:"0",width:"100%",_ver:"1",owner_id:a.C,post_id:a.F,hash:a.B,amp:"1",startWidth:c,url:d,referrer:b,title:"AMP Post"});return E("https://vk.com/widget_post.php",I(e))}))}function T(a){return C(a.element).getReferrerUrl().then((function(b){var c=a.getAmpDoc().getUrl();b=u({app:a.A,width:"100%",_ver:"1",poll_id:a.D,amp:"1",url:c,title:"AMP Poll",description:"",referrer:b});return E("https://vk.com/al_widget_poll.php",I(b))}))}f.buildCallback=function(){this.h=z(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element);z("post"===this.h||"poll"===this.h,"Unknown data-embedtype: "+this.h);"post"===this.h?(this.C=z(this.element.getAttribute("data-owner-id"),"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.F=z(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.B=z(this.element.getAttribute("data-hash"),"The data-hash attribute is required for <amp-vk> Post %s",this.element)):"poll"===this.h&&(this.A=z(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.D=z(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element))};f.layoutCallback=function(){var a=this,b=this.element.ownerDocument.createElement("iframe");this.j=b;this.o=M(this.win,this.H.bind(this));return R(this).then((function(c){b.src=c;b.setAttribute("name","fXD");b.setAttribute("scrolling","no");b.setAttribute("frameborder","0");b.setAttribute("allowfullscreen","true");a.applyFillContent(b);a.element.appendChild(b);return a.loadPromise(b)}))};f.H=function(a){if("https://vk.com"===a.origin&&a.source===this.j.contentWindow){var b=a.data;b&&(a=/\["resize",\[(\d+)\]]/.exec(b))&&a[1]&&(a=parseInt(a[1],10),this.G!==a&&(this.G=a,this.forceChangeHeight(a)))}};f.isLayoutSupported=function(a){return"responsive"===a||"flex-item"===a||"fixed"===a};f.unlayoutOnPause=function(){return!0};f.unlayoutCallback=function(){if(this.j){var a=this.j;a.parentElement&&a.parentElement.removeChild(a);this.j=null}this.o&&this.o();return!0};(function(a){a.registerElement("amp-vk",N)})(self.AMP)}});//# sourceMappingURL=amp-vk-0.1.js.map